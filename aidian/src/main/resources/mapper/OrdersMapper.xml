<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zm.aidian.Mapper.OrdersMapper">
   <resultMap id="OrdersDTO" type="com.zm.aidian.dto.OrdersDTO">
       <id column="id" property="id" javaType="int"/>
       <result column="userid" property="userid" javaType="int"/>
       <result column="menusum" property="menusum"  javaType="int"/>
       <result column="times" property="times"  javaType="string"/>
       <result column="delivery" property="delivery"  javaType="int"/>
       <result column="uname" property="username"  javaType="string"/>
       <result column="phone" property="phone"  javaType="string"/>
       <result column="address" property="address"  javaType="string"/>
       <result column="mname" property="menuname"  javaType="string"/>
       <result column="price1" property="price1"  javaType="float"/>

   </resultMap>

    <select id="selectAllOrdersDAO" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id
    </select>

    <select id="updateDeliveryById" resultType="Orders">
        update orders set delivery=1 where id=#{id}
    </select>
    <select id="deleteById" resultType="Orders">
        delete from orders where id=#{id}
    </select>

    <select id="selectOrdersByUserId" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and o.userid=#{id}
    </select>
    <select id="selectOrdersByMenusName" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and m.name=#{name}
    </select>
    <select id="selectOrderByDate" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and o.times > #{time1} and #{time2} > o.times
    </select>

    <select id="addOrder" parameterType="Orders">
        insert into orders(userid, menuid, menusum, times, delivery) values(#{userid}, #{menuid}, #{menusum}, #{times}, #{delivery})
    </select>

    <select id="selectOrderByDelivery" resultType="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and o.delivery=#{delivery} and u.id=#{id}
    </select>

    <select id="selectOrdersByMenusNameAndId" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and m.name=#{name} and u.id=#{id}
    </select>
    <select id="selectOrderByDateAndId" resultMap="OrdersDTO">
        select o.id,o.userid,u.name uname,u.phone,u.address,m.name mname,o.menusum,m.price1,o.times,o.delivery
        from orders o,menus m,users u
        where o.userid=u.id and o.menuid=m.id and o.times > #{time1} and #{time2} > o.times and u.id=#{id}
    </select>

</mapper>
